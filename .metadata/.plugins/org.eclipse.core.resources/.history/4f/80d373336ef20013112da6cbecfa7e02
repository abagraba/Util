package com.mimvista.cloud.organizer.verifier.panels;

import java.awt.Font;
import java.awt.Window;
import java.awt.event.ActionEvent;
import java.awt.event.ActionListener;
import java.awt.event.WindowEvent;
import java.util.List;

import javax.swing.Box;
import javax.swing.JButton;
import javax.swing.JCheckBox;
import javax.swing.JDialog;
import javax.swing.JLabel;
import javax.swing.JPanel;
import javax.swing.SwingUtilities;
import javax.swing.border.EmptyBorder;

import com.google.common.collect.Lists;
import com.mimvista.cloud.organizer.verifier.VerifierTask;
import com.mimvista.cloud.organizer.verifier.panels.VerifierSearchResultView.VerifierSearchResultViewEnum;
import com.mimvista.cloud.organizer.verifier.proui.BoxUtil;
import com.mimvista.preferencesNew.MIMCloudOrganizerPrefs;

public class VerifierSearchResultDisplayOption extends JDialog {

	private static final long serialVersionUID = 1L;

	private int border = 100;

	private JCheckBox[] choices;
	private JButton cancel = new JButton(VerifierTask.props.getProperty("VERIFIER_CANCEL"));
	private JButton confirm = new JButton(VerifierTask.props.getProperty("VERIFIER_CONFIRM"));

	private ActionListener cancelAction = new ActionListener() {
		@Override
		public void actionPerformed(ActionEvent e) {
			dispatchEvent(new WindowEvent(VerifierSearchResultDisplayOption.this, WindowEvent.WINDOW_CLOSING));
		}
	};
	private ActionListener confirmAction = new ActionListener() {
		@Override
		public void actionPerformed(ActionEvent e) {
			if (saveSettings())
				dispatchEvent(new WindowEvent(VerifierSearchResultDisplayOption.this, WindowEvent.WINDOW_CLOSING));
		}
	};

	public VerifierSearchResultDisplayOption(Window window, VerifierSearchResultDisplay display) {
		super(window, "Open File", ModalityType.APPLICATION_MODAL);
		JPanel content = BoxUtil.verticalBox();
		content.setBorder(new EmptyBorder(border, border, border, border));

		JLabel title = new JLabel("Search View Options");
		title.setFont(title.getFont().deriveFont(Font.BOLD, 24));

		choices = new JCheckBox[VerifierSearchResultViewEnum.values().length];

		BoxUtil.insert(title, content);
		BoxUtil.addStrut(content, 25);
		BoxUtil.insert(makeGrid(2, VerifierSearchResultViewEnum.values()), content);
		for (VerifierSearchResultViewEnum value : getSettings())
			choices[value.ordinal()].setSelected(true);

		cancel.addActionListener(cancelAction);
		confirm.addActionListener(confirmAction);

		JPanel buttons = BoxUtil.horizontalBox();
		BoxUtil.insert(cancel, buttons);
		BoxUtil.addStrut(buttons, 10);
		BoxUtil.insert(confirm, buttons);

		BoxUtil.addStrut(content, 25);
		BoxUtil.insert(buttons, content);

		setContentPane(content);
		pack();
		setVisible(true);
	}

	private JPanel makeGrid(int columns, VerifierSearchResultViewEnum[] values) {
		JPanel grid = BoxUtil.horizontalBox();
		JPanel[] boxes = new JPanel[columns];
		for (int c = 0; c < columns; c++) {
			boxes[c] = BoxUtil.verticalBox();
			BoxUtil.insert(boxes[c], grid);
		}
		int i = 0;
		for (VerifierSearchResultViewEnum option : values) {
			JCheckBox box = new JCheckBox(option.toString());
			BoxUtil.insert(box, boxes[i++ * columns / values.length]);
			choices[i] = box;
		}
		return grid;
	}

	private static JCheckBox makeBox(JPanel container, VerifierSearchResultViewEnum e) {
		JCheckBox box = new JCheckBox(e.toString());
		container.add(box);
		container.add(Box.createVerticalStrut(5));
		return box;
	}

	public boolean saveSettings() {
		List<VerifierSearchResultViewEnum> settings = Lists.newArrayList();
		for (int i = 0; i < choices.length; i++)
			if (choices[i].isSelected())
				settings.add(VerifierSearchResultViewEnum.values()[i]);
		String[] save = new String[settings.size()];
		int i = 0;
		for (VerifierSearchResultViewEnum setting : settings)
			save[i++] = setting.name();
		if (save.length == 0)
			return false;
		MIMCloudOrganizerPrefs.resultDisplayColumns.setValue(save);
		return true;
	}

	public VerifierSearchResultViewEnum[] getSettings() {
		String[] saved = MIMCloudOrganizerPrefs.resultDisplayColumns.getValue();
		VerifierSearchResultViewEnum[] settings = new VerifierSearchResultViewEnum[saved.length];
		int i = 0;
		for (String save : saved) {
			settings[i++] = VerifierSearchResultViewEnum.valueOf(save);
		}
		return settings;
	}
}
